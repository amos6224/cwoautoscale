<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>cwoautoscale by cloudwebops</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>cwoautoscale</h1>
        <p></p>

        <p class="view"><a href="https://github.com/cloudwebops/cwoautoscale">View the Project on GitHub <small>cloudwebops/cwoautoscale</small></a></p>


        <ul>
          <li><a href="https://github.com/cloudwebops/cwoautoscale/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/cloudwebops/cwoautoscale/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/cloudwebops/cwoautoscale">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="cwoautoscale-ansible-playbook" class="anchor" href="#cwoautoscale-ansible-playbook" aria-hidden="true"><span class="octicon octicon-link"></span></a>CWOAUTOSCALE Ansible playbook:</h1>

<p>NOTE: this playbook has been created for testing purpose and for later reuse in production environments as a part of work on DR solution
      testing has been successfully completed on Disaster Recovery Management instance (drman):<br>
      high CPU usage for scale-up/scale-down testing has been generated with "stress" package ($sudo apt-get install stress)</p>

<h2>
<a id="cwoautoscale-ansible-playbook-consist-of-3-parts" class="anchor" href="#cwoautoscale-ansible-playbook-consist-of-3-parts" aria-hidden="true"><span class="octicon octicon-link"></span></a>CWOAUTOSCALE Ansible playbook consist of 3 parts:</h2>

<h3>
<a id="1-deploy-test_autoscaling_envyml" class="anchor" href="#1-deploy-test_autoscaling_envyml" aria-hidden="true"><span class="octicon octicon-link"></span></a>1. deploy-test_autoscaling_env.yml</h3>

<pre><code>  -create 1 x VPC with 1 x VPC subnets in 1 x AZ in one AWS region (we are using for testing eu-west1 on separate AWS TEST account),
  -create 1 x security group,
  -provision 1x EC2_APP instances in 1x AZ # GOLD instance (Required later to create GOLD AMI,Launch Configuration and Autoscaling group),
  -launch and configure elb1 public facing VPC ELB (cross_az_load_balancing) and attach VPC subnets,
  -install appservers.yml role on EC2_APP instances (this role install nginx and is it required to allow instances registration to ELB,
  -deregister and register EC2_APP instances on ELB.


All static variables are defined in main.yml and dynamic variables are registered, during playbook execution, in vpc_info.yml file (aws_vars/prod folder)
variables:  regions, az, vpc, subnets, elb dns name info, keypair, GOLD instance ID, instance types, AMI ID etc.
</code></pre>

<p>Playbook execution: $ansible-playbook -i aws_hosts deploy-test_autoscaling_env.yml</p>

<h3>
<a id="2-ec2_amiyml" class="anchor" href="#2-ec2_amiyml" aria-hidden="true"><span class="octicon octicon-link"></span></a>2. ec2_ami.yml</h3>

<pre><code>   - create GOLD AMI from GOLD instance (Required to complete deploys and rollbacks)

Playbook execution: $ansible-playbook -i aws_hosts ec2_ami.yml
</code></pre>

<h3>
<a id="3-autoscalingyml" class="anchor" href="#3-autoscalingyml" aria-hidden="true"><span class="octicon octicon-link"></span></a>3. autoscaling.yml</h3>

<pre><code>   - create Launch config (from GOLD AMI)
   - create ASG (autoscaling group)
   - configure Scaling Policies
   - determine Metric Alarm configuration
   - configure Metric Alarms and link to Scaling Policies
</code></pre>

<p>Playbook execution: $ansible-playbook -i autoscaling.yml</p>

<p>Initial ASG creation, Deploys, Rollbacks
     First autoscaling.yml playbook run will create and configure initial LC, ASG, and SP 
     each other autoscaling.yml playbook run with changed LC will start NEW instances and replace all OLD instances in ASG group
     each other autoscaling.yml playbook run with changed  Scaling Policies, Metric Alarm configuration will update the ASG configuration</p>

<p>Notification (alerts) about all activity in ASG: scaling up/ scaling down and instance creation/termination  need to be configured on the AWS web console </p>

<h2>
<a id="ansible-installation" class="anchor" href="#ansible-installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>ANSIBLE INSTALLATION</h2>

<h3>
<a id="1-ansible-and-boto-installation-ubuntu-1404-lts" class="anchor" href="#1-ansible-and-boto-installation-ubuntu-1404-lts" aria-hidden="true"><span class="octicon octicon-link"></span></a>1. Ansible and Boto installation Ubuntu 14.04 LTS</h3>

<p>$ sudo apt-get install software-properties-common
  $ sudo apt-add-repository ppa:ansible/ansible
  $ sudo apt-get update
  $ sudo apt-get install ansible
  $ apt-get install python-pip
  $ pip install boto</p>

<h3>
<a id="2-download-to-folder-etcansible" class="anchor" href="#2-download-to-folder-etcansible" aria-hidden="true"><span class="octicon octicon-link"></span></a>2. Download to folder /etc/ansible/</h3>

<p>$ wget <a href="https://raw.github.com/ansible/ansible/devel/plugins/inventory/ec2.py">https://raw.github.com/ansible/ansible/devel/plugins/inventory/ec2.py</a>
  $ wget <a href="https://raw.githubusercontent.com/ansible/ansible/devel/plugins/inventory/ec2.ini">https://raw.githubusercontent.com/ansible/ansible/devel/plugins/inventory/ec2.ini</a>
  $ chmod +x /etc/ansible/ec2.py</p>

<h3>
<a id="3-in-aws-console-create-iam-user-with-poweruser-privileges-add-in-file-homeubuntuboto" class="anchor" href="#3-in-aws-console-create-iam-user-with-poweruser-privileges-add-in-file-homeubuntuboto" aria-hidden="true"><span class="octicon octicon-link"></span></a>3. In aws console create IAM user with PowerUser privileges Add in file /home/ubuntu/.boto</h3>

<p>[Credentials]
  aws_access_key_id = XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
  aws_secret_access_key = XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</p>

<h3>
<a id="4-add-in-clean-file-homeubuntuansiblecfg" class="anchor" href="#4-add-in-clean-file-homeubuntuansiblecfg" aria-hidden="true"><span class="octicon octicon-link"></span></a>4. Add in clean file /home/ubuntu/.ansible.cfg</h3>

<p>[defaults]
  host_key_checking = False
  private_key_file=/home/ubuntu/.ssh/.pem</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/cloudwebops">cloudwebops</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
